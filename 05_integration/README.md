# Integration Module

System-level decision logic and ML notification optimizer.

## Structure

```
05_integration/
├── __init__.py                 # Module marker
├── decision_logic.py           # Core control logic
├── notification_optimizer.py   # ML model for notifications
├── validate.py                 # Integration tests
└── README.md
```

## Purpose

Coordinate all modules to make system-level decisions:

1. When to close gates (based on train ETA)
2. When to notify intersections (ML-optimized)
3. Safety validation

## Components

### CrossingController

Main system controller:

- Processes sensor detections
- Calculates decisions based on ETA
- Coordinates gate and notification timing

### SafetyValidator

Validates safety constraints:

- Checks notification provides safe clearance
- Validates system configuration
- Calculates safety margins

### NotificationOptimizer (ML)

Machine learning model for notification timing:

- Learns optimal notification times
- Balances safety vs. efficiency
- Adapts to traffic patterns

## Usage

### Decision Logic

```python
from 05_integration.decision_logic import CrossingController

controller = CrossingController()

# Process sensor detection
decisions = controller.process_sensor_detection(
    sensor_timings={'sensor_0_entry': 0, 'sensor_1_entry': 24, 'sensor_2_entry': 42},
    eta=25.0
)

print(f"Close gates: {decisions['close_gates']}")
print(f"Notify: {decisions['notify_intersections']}")
```

### Safety Validation

```python
from 05_integration.decision_logic import SafetyValidator

validator = SafetyValidator()

result = validator.validate_notification_timing(
    train_eta=60.0,
    notification_time=20.0,
    traffic_density='heavy',
    intersection_distance=500
)

print(f"Safe: {result['is_safe']}")
print(f"Safety margin: {result['safety_margin']}s")
```

### ML Optimizer

```python
from 05_integration.notification_optimizer import NotificationOptimizer

# Train model
optimizer = NotificationOptimizer()
X, y = optimizer.generate_training_data(num_scenarios=500)
optimizer.train(X, y)
optimizer.save_model('models/notification_model.pkl')

# Use model
notification_time = optimizer.predict(
    train_eta=60.0,
    traffic_density='heavy',
    intersection_distance=500
)
print(f"Optimal notification: {notification_time}s")
```

## ML Training Data

Generated by simulating outcomes:

- 500 scenarios with varying conditions
- Features: [train_eta, traffic_density, intersection_distance]
- Target: optimal_notification_time
- Optimization: minimize wait + ensure safety

## Validation

```bash
make integration-validate
```

Tests:

1. Controller initialization
2. Decision logic correctness
3. Safety validation
4. System constraints check
5. ML model training and prediction

---

**Module Version**: 1.0.0  
**Files**: 4 files (~500 lines)  
**Dependencies**: All previous modules
